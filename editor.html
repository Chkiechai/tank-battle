<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <style>
    body {
      height: 95dvh;
      min-height: 800px;
      margin: 5px;
    }
    div#container{
      display:flex;
      flex-direction: row;
      justify-content: center;
      align-items: stretch;
      height: 100%;
    }
    div.column {
      flex: 0 0 auto;
      display:flex;
      flex-direction: column;
      align-items:stretch;
      margin:8px;
      min-width: 800px;
    }
    div.flex1 {
      flex: 1;
      display:flex;
      flex-direction:column;
      align-items:stretch;
      border-left: 1px dotted gray;
    }
    div.row {
      flex: 0;
      display:flex;
      flex-direction: row;
      gap: 10px;
    }
    div.row > button {
      flex: 1;
    }
    div#game {
      height: 600px;
    }
    div#output {
      flex-grow: 1;
      margin-top:8px;
      background: lightgray;
      font-family: monospace;
      overflow: auto;
      padding-left: 8px;
    }
    div#monaco-editor-embed {
      flex: auto;
      flex-grow:2;
      margin:8px;
    }
    </style>
  </head>
  <div id="container">
    <div class="column">
      <div id="game"></div>
      <div id="output">some test output</div>
    </div>
    <div class="column">
      <div class="flex1">
        <div id="loader">Loading...</div>
        <div id="monaco-editor-embed" style="height: 800px;" />
      </div>
      <div class="row">
        <button onClick="shipCode()">Ship It!</button>
        <button onClick="shipCode()">Check It</button>
        <button onClick="shipCode()">Reformat</button>
        <button onClick="shipCode()">Download</button>
      </div>
    </div>
  </div>
  <script>
//    // First set up the VSCode loader in a script tag
//    const getLoaderScript = document.createElement('script')
//    getLoaderScript.src = 'https://www.typescriptlang.org/js/vs.loader.js'
//    getLoaderScript.async = true
//    getLoaderScript.onload = () => {
//      // Now the loader is ready, tell require where it can get the version of monaco, and the sandbox
//      // This version uses the latest version of the sandbox, which is used on the TypeScript website
//
//      // For the monaco version you can use unpkg or the TypeSCript web infra CDN
//      // You can see the available releases for TypeScript here:
//      // https://playgroundcdn.typescriptlang.org/indexes/releases.json
//      //
//      require.config({
//        paths: {
//          vs: 'https://playgroundcdn.typescriptlang.org/cdn/4.0.5/monaco/min/vs',
//          // vs: 'https://unpkg.com/@typescript-deploys/monaco-editor@4.0.5/min/vs',
//          sandbox: 'https://www.typescriptlang.org/js/sandbox',
//        },
//        // This is something you need for monaco to work
//        ignoreDuplicateModules: ['vs/editor/editor.main'],
//      })
//
//      // Grab a copy of monaco, TypeScript and the sandbox
//      require(['vs/editor/editor.main', 'vs/language/typescript/tsWorker', 'sandbox/index'], (
//        main,
//        _tsWorker,
//        sandboxFactory
//      ) => {
//        const initialCode = `  
//import {Controls,Sensors} from "./tank-api";
//let wheel_base = 20;
//  function drive_speed_and_angle(control:Controls,speed:number,angvel:number) {
//    let rad = speed/angvel;
//    if(angvel > 0) {
//      control.left_track_speed = rad/(rad+wheel_base)*speed;
//      control.right_track_speed = speed;
//    } else if(angvel < 0) {
//      control.left_track_speed = speed;
//      control.right_track_speed = rad/(rad+wheel_base)*speed;
//    } else {
//      control.left_track_speed = speed;
//      control.right_track_speed = speed;
//    }
//  }
//
//  function drive_radius(control:Controls,radius:number,speed:number) {
//    let ang_vel = speed/radius;
//    drive_speed_and_angle(control,speed,ang_vel);
//  }
//  //console.log("Inside tank code: controls = ",controls);
//  controls.turn_gun = 1.0;
//  drive_radius(controls, -30, 50);
//  return controls;
//`;
//
//        const isOK = main && window.ts && sandboxFactory
//        if (isOK) {
//          document.getElementById('loader').parentNode.removeChild(document.getElementById('loader'))
//        } else {
//          console.error('Could not get all the dependencies of sandbox set up!')
//          console.error('main', !!main, 'ts', !!window.ts, 'sandbox', !!sandbox)
//          return
//        }
//
//        // Create a sandbox and embed it into the div #monaco-editor-embed
//        const sandboxConfig = {
//          text: initialCode,
//          compilerOptions: {},
//          domID: 'monaco-editor-embed',
//        }
//
//        const sandbox = sandboxFactory.createTypeScriptSandbox(sandboxConfig, main, window.ts);
//        fetch("tank-api.d.ts")
//          .then((response)=>response.text())
//          .then((tank_api)=> sandbox.languageServiceDefaults.addExtraLib(tank_api,"file:///tank-api.d.ts"))
//          .then((_)=> sandbox.editor.focus())
//          ;
//      })
//    }
//
//    document.body.appendChild(getLoaderScript)
  </script>
  <script src="dist/app.js"></script>
</html>

